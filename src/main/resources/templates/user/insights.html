<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>

    <meta charset="utf-8"/>
    <title>CodeInsighter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description"/>
    <meta content="Coderthemes" name="author"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <!-- App favicon -->
    <link rel="shortcut icon" th:href="@{/static/images/favicon.ico}">

    <!-- Plugins css -->
    <link th:href="@{/libs/flatpickr/flatpickr.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/libs/selectize/css/selectize.bootstrap3.css}" rel="stylesheet" type="text/css"/>

    <!-- Loading button css -->
    <link th:href="@{/libs/ladda/ladda.min.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/libs/ladda/ladda-themeless.min.css}" rel="stylesheet" type="text/css" />

    <!-- App css -->
    <link th:href="@{/css/config/default/bootstrap.min.css}" rel="stylesheet" type="text/css"
          id="bs-default-stylesheet"/>
    <link th:href="@{/css/config/default/app.min.css}" rel="stylesheet" type="text/css" id="app-default-stylesheet"/>

    <link th:href="@{/css/config/default/bootstrap-dark.min.css}" rel="stylesheet" type="text/css"
          id="bs-dark-stylesheet"/>
    <link th:href="@{/css/config/default/app-dark.min.css}" rel="stylesheet" type="text/css"
          id="app-dark-stylesheet"/>

    <!-- icons -->
    <link th:href="@{/css/icons.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/acsr.css}" rel="stylesheet" type="text/css"/>

</head>

<!-- body start -->
<body class="loading"
      data-layout='{"mode": "light", "width": "fluid", "menuPosition": "fixed", "sidebar": { "color": "light", "size": "default", "showuser": false}, "topbar": {"color": "dark"}, "showRightSidebarOnPageLoad": true}'>

<!-- Begin page -->
<div id="wrapper">

    <!-- Topbar Start -->
    <div class="navbar-custom">
        <div class="container-fluid">


            <!-- LOGO -->
            <div class="logo-box">
                <a href="#" class="logo logo-dark text-center">
                    <span class="logo-sm">
                         <img alt="CodeInsighter" th:src="@{../../../../static/images/code-logo-light.png}" width="250">
                    </span>
                    <span class="logo-lg">
                        <img alt="CodeInsighter" th:src="@{../../../../static/images/code-logo-light.png}" width="250">
                    </span>
                </a>

                <a href="#" class="logo logo-light text-center">
                    <span class="logo-sm">
                        <img alt="CodeInsighter" th:src="@{../../../../static/images/code-logo-light.png}" width="250">
                    </span>
                    <span class="logo-lg">
                        <img alt="CodeInsighter" th:src="@{../../../../static/images/code-logo-light.png}" width="250">
                    </span>
                </a>
            </div>

            <ul class="list-unstyled topnav-menu topnav-menu-left m-0">
                <li>
                    <!-- Mobile menu toggle (Horizontal Layout)-->
                    <a class="navbar-toggle nav-link" data-bs-toggle="collapse" data-bs-target="#topnav-menu-content">
                        <div class="lines">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </a>
                    <!-- End mobile menu toggle-->
                </li>
            </ul>

            <ul class="list-unstyled topnav-menu float-end mb-0">

                <li class="dropdown d-none d-lg-inline-block">
                    <a class="nav-link dropdown-toggle arrow-none waves-effect waves-light" data-toggle="fullscreen"
                       href="#">
                        <i class="fe-maximize noti-icon"></i>
                    </a>
                </li>

                <li class="dropdown notification-list topbar-dropdown">
                    <a class="nav-link dropdown-toggle nav-user me-0 waves-effect waves-light" data-bs-toggle="dropdown"
                       href="#" role="button" aria-haspopup="false" aria-expanded="false">
                        <img id="myImage" th:src="${userData.avatarUrl}" alt="user-image" class="rounded-circle">
                        <span id="myName" class="pro-user-name ms-1" th:text="${userData.name}">
                         <i class="mdi mdi-chevron-down"></i>
                        </span>
                        <span id="myUserId" style="display: none" th:text="${userData.id}"></span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end profile-dropdown ">
                        <!-- item-->
                        <div class="dropdown-header noti-title">
                            <h6 class="text-overflow m-0">Welcome !</h6>
                        </div>

                        <!-- item-->
                        <a href="javascript:void(0);" id="logout-btn" class="dropdown-item notify-item">
                            <i class="fe-log-out"></i>
                            <span>Logout</span>
                        </a>

                    </div>
                </li>

            </ul>

            <div class="clearfix"></div>
        </div>
    </div>
    <!-- end Topbar -->

    <!-- ========== Left Sidebar Start ========== -->
    <div class="left-side-menu">

        <div class="h-100" data-simplebar>

            <!--- Sidemenu -->
            <div id="sidebar-menu">

                <ul id="side-menu">

                    <li class="menu-title">Navigation</li>

                    <li>
                        <a href="#" id="reposPage">
                            <i class="fe-grid"></i>
                            <span> Repositories </span>
                        </a>
                        <a href="#" id="repoStatPage">
                            <i class="fe-pie-chart"></i>
                            <span> Statistics </span>
                        </a>
                    </li>

                </ul>

            </div>
            <!-- End Sidebar -->

            <div class="clearfix"></div>

        </div>
        <!-- Sidebar -left -->

    </div>
    <!-- Left Sidebar End -->

    <!-- ============================================================== -->
    <!-- Start Page Content here -->
    <!-- ============================================================== -->

    <div class="content-page">
        <div class="content">

            <!-- Start Content-->
            <div class="container-fluid">

                <!-- start page title -->
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box">
                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a th:href="${'/users/'+ userData.id}"
                                                                   id="reposBreadcrumb">Repositories</a></li>
                                    <li class="breadcrumb-item"><a th:href="${'/users/repo/'+ repoData.id}"
                                                                   th:text="${repoData.name}"></a></li>
                                    <li class="breadcrumb-item active"><span>Insights</span></li>
                                </ol>
                            </div>
                            <h4 class="page-title"><span th:text="${repoData.name}"></span> 's Insights</h4>
                            <span id="myRepoId" style="display: none" th:text="${repoData.id}"></span>
                        </div>
                    </div>
                </div>

                <div class="container-fluid">
                    <div class="row">
                        <!-- Ensure that each button has the same classes for margin and padding -->
                        <div class="col-lg-2 mb-3 d-grid">
                            <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#commonCodeMistakesContent" aria-expanded="false"
                                    aria-controls="commonCodeMistakesContent">
                                <h5 class="font-size-15 text-uppercase text-white-50">Common Code Mistakes</h5>
                            </button>
                        </div>
                        <div class="col-lg-2 mb-3 d-grid">
                            <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#codeQualityEnhancementContent" aria-expanded="false"
                                    aria-controls="codeQualityEnhancementContent">
                                <h5 class="font-size-15 text-uppercase text-white-50">Code Quality Enhancement</h5>
                            </button>
                        </div>
                        <div class="col-lg-2 mb-3 d-grid">
                            <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#customCodeLintingContent" aria-expanded="false"
                                    aria-controls="customCodeLintingContent">
                                <h5 class="font-size-15 text-uppercase text-white-50">Custom Code Linting</h5>
                            </button>
                        </div>
                        <div class="col-lg-2 mb-3 d-grid">
                            <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#bugDetectionContent" aria-expanded="false"
                                    aria-controls="bugDetectionContent">
                                <h5 class="font-size-15 text-uppercase text-white-50">Bug Detection in Application Flow</h5>
                            </button>
                        </div>
                        <div class="col-lg-2 mb-3 d-grid">
                            <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collaborationAnalysisContent" aria-expanded="false"
                                    aria-controls="collaborationAnalysisContent">
                                <h5 class="font-size-15 text-uppercase text-white-50">Collaboration Analysis</h5>
                            </button>
                        </div>
                        <div class="col-lg-2 mb-3 d-grid">
                            <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#dependencyVersionCompatibilityContent" aria-expanded="false"
                                    aria-controls="dependencyVersionCompatibilityContent">
                                <h5 class="font-size-15 text-uppercase text-white-50">Dependency Version Compatibility</h5>
                            </button>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <!-- Ensure that each button has the same classes for margin and padding -->
                        <div class="col-lg-2 mb-3 d-grid">
                            <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#testCaseMinimizationContent" aria-expanded="false"
                                    aria-controls="testCaseMinimizationContent">
                                <h5 class="font-size-15 text-uppercase text-white-50">Test Case Minimization</h5>
                            </button>
                        </div>
                        <div class="col-lg-2 mb-3 d-grid">
                            <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#advanceCodeSearchContent" aria-expanded="false"
                                    aria-controls="advanceCodeSearchContent">
                                <h5 class="font-size-15 text-uppercase text-white-50">Advance Code Search & Retrieval</h5>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Collapsible content sections -->
                <div class="col-lg-12">
                    <div class="collapse" id="commonCodeMistakesContent">
                        <div class="card card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3 class="mb-0">Common Code Mistakes</h3>
                                <button class="ladda-button btn btn-primary" data-style="expand-right" id="commonCodeMistakesNav">Get Insights</button>
                            </div>
                            <br>
                            <span>This feature leverages the Large Language Model (LLM) to suggest Common Code Mistakes Insights based on common types of mistakes occurring in the code by using the code review comments. </span>
                            <hr style="height:2px;">
                            <div class="row justify-content-center">
                                <div id="commonCodeMistakesContainer"></div>
                            </div>
                        </div>
                    </div>
                    <div class="collapse" id="codeQualityEnhancementContent">
                        <div class="card card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3 class="mb-0">Code Quality Enhancement</h3>
                                <button class="ladda-button btn btn-primary" data-style="expand-right" id="codeQualityEnhancementNav">Get Insights</button>
                            </div>
                            <br>
                            <span>This feature leverages the Large Language Model (LLM) to suggest code improvements based on different criteria like Readability, Performance, Correctness, and Scalability. On open Pull Requests (PRs) by the first 3 developers who recently raised a PR, so that we can ensure code quality, adherence to coding standards, and catch potential issues early in the development process.</span>
                            <hr style="height:2px;">
                            <div class="row justify-content-center">
                                <div id="codeQualityEnhancementContainer"></div>
                            </div>
                        </div>
                    </div>
                    <div class="collapse" id="customCodeLintingContent">
                        <div class="card card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3 class="mb-0">Custom Code Linting</h3>
                                <button class="ladda-button btn btn-primary" data-style="expand-right" id="customCodeLintingNav">Get Insights</button>
                            </div>
                            <br>
                            <span>This feature leverages a Large Language Model (LLM) to analyze adherence to Linting Rules. It distinguishes itself from conventional code Linting by assessing code pushed by developers within open Pull Requests (PRs) and executing checks to ensure compliance with Linting standards. </span>
                            <hr style="height:2px;">
                            <div class="row justify-content-center">
                                <div id="customCodeLintingContainer"></div>
                            </div>
                        </div>
                    </div>
                    <div class="collapse" id="bugDetectionContent">
                        <div class="card card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3 class="mb-0">Bug Detection in Application Flow</h3>
                                <button class="ladda-button btn btn-primary" data-style="expand-right" id="bugDetectionInApplicationFlowNav">Get Insights
                                </button>
                            </div>
                            <br>
                            <span>This feature employ a Large Language Model (LLM) to analyze any application's major flows to identify potential issues or gaps. This feature is different from traditional code review. Here, the application will consider code pushed by the developer in any open PR that can introduce unexpected bugs in the application's major flows. </span>
                            <hr style="height:2px;">
                            <div class="row justify-content-center">
                                <div id="bugDetectionInApplicationFlowContainer"></div>
                            </div>
                        </div>
                    </div>
                    <div class="collapse" id="collaborationAnalysisContent">
                        <div class="card card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3 class="mb-0">Collaboration Analysis</h3>
                                <button class="ladda-button btn btn-primary" data-style="expand-right" id="collaborationAnalysisNav">Get Insights</button>
                            </div>
                            <br>
                            <span>This feature leverages the Large Language Model (LLM) to to identify active contributors and their impact on the repository. This feature will analyze collaboration patterns, such as who works together frequently on issues and pull requests.</span>
                            <hr style="height:2px;">
                            <div class="row justify-content-center">
                                <div id="collaborationAnalysisContainer"></div>
                            </div>
                        </div>
                    </div>
                    <div class="collapse" id="dependencyVersionCompatibilityContent">
                        <div class="card card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3 class="mb-0">Dependency Version Compatibility</h3>
                                <button class="ladda-button btn btn-primary" data-style="expand-right" id="dependencyVersionNav">Get Insights</button>
                            </div>
                            <br>
                            <span>This feature leverages a Large Language Model (LLM) to analyze the dependency Version compatability. Currently, it is for Java Maven projects that has pom.xml </span>
                            <hr style="height:2px;">
                            <div class="row justify-content-center">
                                <div id="dependencyVersionContainer"></div>
                            </div>
                        </div>
                    </div>
                    <div class="collapse" id="testCaseMinimizationContent">
                        <div class="card card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3 class="mb-0">Test Case Minimization</h3>
                                <button class="ladda-button btn btn-primary" data-style="expand-right" id="testCaseMinimizationNav">Get Insights</button>
                            </div>
                            <br>
                            <span>This feature leverages a Large Language Model (LLM) to analyse trivial test cases in a repository. This will check test cases corresponding to each Pull Request and will provide insights about them.</span>
                            <hr style="height:2px;">
                            <div class="row justify-content-center">
                                <div id="testCaseMinimizationContainer"></div>
                            </div>
                        </div>
                    </div>
                    <div class="collapse" id="advanceCodeSearchContent">
                        <div class="card card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3 class="mb-0">Advance Code Search & Retrieval</h3>
                            </div>
                            <br>
                            <span>This feature leverages the capabilities of a Language Model (LLM) to implement an advanced code search and retrieval system to efficiently locate specific code flows within any codebase.</span>
                            <br>
                            <div class="d-flex justify-content-center">
                                <div class="flex-grow-1 me-2"> <!-- flex-grow-1 makes the input grow to fill the space -->
                                    <input type="text" class="form-control" placeholder="Type for the component you want to search for here..." id="inputData">
                                </div>
                                <button class="ladda-button btn btn-primary" data-style="expand-right" id="advanceCodeSearchNav">Search Component</button>
                            </div>
                            <hr style="height:2px;">
                            <div class="row justify-content-center">
                                <div id="advanceCodeSearchContainer"></div>
                            </div>
                        </div>
                    </div>
                    <!-- ... other content sections ... -->
                </div>

            </div>
            <!-- end row -->

        </div>

        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->

        <span id="dynamicURL" style="display: none"
              th:text="${#httpServletRequest.scheme + '://' + #httpServletRequest.serverName + ':' + #httpServletRequest.serverPort + #httpServletRequest.contextPath}">
        </span>
    </div>
</div>
<!-- END wrapper -->


<!-- Vendor js -->
<script th:src="@{/js/vendor.min.js}"></script>

<!-- Plugins js-->
<script th:src="@{/libs/flatpickr/flatpickr.min.js}"></script>
<script th:src="@{/libs/apexcharts/apexcharts.min.js}"></script>

<script th:src="@{/libs/selectize/js/standalone/selectize.min.js}"></script>

<!-- Chart js -->
<script type="text/javascript" th:src="@{/libs/chart.js/Chart.min.js}"></script>

<!-- Dashboar 1 init js-->
<script th:src="@{/js/pages/dashboard-1.init.js}"></script>

<!-- App js-->
<script th:src="@{/js/app.min.js}"></script>
<script type="text/javascript" src="/webjars/js-cookie/js.cookie.js"></script>

<!--ladda spinner js-->
<script th:src="@{/libs/ladda/spin.min.js}"></script>
<script th:src="@{/libs/ladda/ladda.min.js}"></script>

<script type="text/javascript">
    $.ajaxSetup({
        beforeSend: function (xhr, settings) {
            if (settings.type == 'POST' || settings.type == 'PUT' || settings.type == 'DELETE') {
                if (!(/^http:.*/.test(settings.url) || /^https:/
                    .test(settings.url))) {
                    // Only send the tokens to relative URLs i.e. locally.
                    xhr.setRequestHeader("X-XSRF-TOKEN", Cookies.get('XSRF-TOKEN'));
                }
            }
        }
    })

    function redirectToLogout(dynamicURL) {
        $('#logout-btn').on('click', function () {
            $.post("/logout", function () {
                location.href = dynamicURL;
            })
        });
    }

    $(document).ready(function () {
            console.log("Document is ready")
        var dynamicURL = $("#dynamicURL").text();
        redirectToLogout(dynamicURL);
        var myRepoId = $("#myRepoId").text();
        var myUserId = $("#myUserId").text();
        var reposPage = "/users/" + myUserId;
        $("#reposPage").attr("href", reposPage);
        $("#reposBreadcrumb").attr("href", reposPage);
        var repoStatPage = "/users/repo/" + myRepoId;
        $("#repoStatPage").attr("href", repoStatPage);

        getInsights(myRepoId);
    });

    function getInsights(myRepoId) {
        //Common Code Mistakes Insight Call
        $('#commonCodeMistakesNav').click(function () {
            console.log("CCM Clicked")
            //$("#spinner-ccm").show(); //Load button clicked show spinner
            var l = Ladda.create(this);
            l.start();
            $.ajax({
                url: 'get-insights/ccm',
                method: 'GET',
                dataType: 'json',
                success: function (jsonData) {
                    console.log("CCMD: " + jsonData);
                    console.log("CCM: " + jsonData.insights);
                    $('#commonCodeMistakesContainer').empty();
                    $('#commonCodeMistakesContainer').html(jsonData.insights);
                },
                complete: function () {
                    l.stop();
                },
                error: function (err) {
                    l.stop();
                    console.error('Error fetching data:', err);

                    try {
                        var errorData = JSON.parse(err.responseText);
                        console.log('Error data:', errorData);
                    } catch (e) {
                        console.error('Error parsing JSON:', e);
                    }

                }
            });
        });

        //Common Quality Enhancement Insight Call
        $('#codeQualityEnhancementNav').click(function () {
            console.log("CQE Clicked")
            var l = Ladda.create(this);
            l.start();
            $.ajax({
                url: 'get-insights/cqe',
                method: 'GET',
                dataType: 'json',
                success: function (jsonData) {
                    console.log(jsonData);
                    $('#codeQualityEnhancementContainer').empty();
                    if (Array.isArray(jsonData) && jsonData.length > 0) {
                        jsonData.forEach((data, index) => {
                            var chartContainer = $("<div>").attr("id", `chart-${index}`).addClass("chart-container").appendTo("#codeQualityEnhancementContainer");
                            $("<h5>").html(`<span style="color: red;">${data.developer}</span> - ${data.pr_title}`).appendTo(chartContainer);
                            if (data.code_improvements && data.code_improvements.length > 0) {
                                $(`<span style="font-weight:bold;">Code Improvement Suggestions: </span>`).appendTo(chartContainer);
                                var codeImprovementsList = $("<ul>").appendTo(chartContainer);
                                data.code_improvements.forEach((improvement) => {
                                    $("<li>").text(improvement).appendTo(codeImprovementsList);
                                });
                                if (!data.score.every(val => val === 0)) {
                                    console.log("Score: " + data.score);
                                    var canvas = $("<canvas>").appendTo(chartContainer);
                                    var ctx = canvas[0].getContext("2d");
                                    var barColors = data.criteria.map(function () {
                                        return getRandomColor();
                                    });

                                    var backgroundColor = barColors.map(function (color) {
                                        return color.backgroundColor;
                                    });
                                    var borderColor = barColors.map(function (color) {
                                        return color.borderColor;
                                    });

                                    new Chart(ctx, {
                                        type: 'bar',
                                        data: {
                                            labels: data.criteria,
                                            datasets: [{
                                                label: 'Score',
                                                data: data.score,
                                                backgroundColor: backgroundColor,
                                                borderColor: borderColor,
                                                borderWidth: 1
                                            }]
                                        },
                                        options: {
                                            scales: {
                                                y: {
                                                    beginAtZero: true,
                                                    suggestedMin: 0,
                                                    suggestedMax: 5
                                                }
                                            }
                                        }
                                    });
                                }
                            } else {
                                $("<h3>").html(`<span style="color: #263b0f;">No Code improvements need for this PR</span>`).appendTo(chartContainer);
                            }
                            $(`<hr>`).appendTo(chartContainer);
                        });
                    } else {
                        // If jsonData is not a valid JSON array, display it as a string
                        $('#codeQualityEnhancementContainer').empty();
                        $('#codeQualityEnhancementContainer').html(`<h3>${jsonData.message}</h3>`);
                    }
                },
                complete: function () {
                    l.stop();
                },
                error: function (err) {
                    l.stop();
                    console.error('Error fetching data:', err);
                    console.log(err.responseText);
                }
            });
        });

        //Bug Detection In Application Flow Insight Call
        $('#bugDetectionInApplicationFlowNav').click(function () {
            console.log("BDAF Clicked")
            var l = Ladda.create(this);
            l.start();
            $.ajax({
                url: 'get-insights/bdaf',
                method: 'GET',
                dataType: 'json',
                success: function (jsonData) {
                    console.log("jsonData: " + jsonData)
                    $('#bugDetectionInApplicationFlowContainer').empty();
                    if (Array.isArray(jsonData)) {
                        var insightContainer = $("<div>").addClass("container").appendTo("#bugDetectionInApplicationFlowContainer");
                        $("<br>").appendTo(insightContainer);
                        jsonData.forEach((data, index) => {
                            $("<h5>").html(`<span style="color: red;">${data.developer}</span> - ${data.pr_title}`).appendTo(insightContainer);

                            // Bugs Section
                            var bugsContainer = $("<div>").addClass("row mt-2").appendTo(insightContainer);
                            var bugsContainerDanger = $("<div>").addClass("alert alert-danger").attr("role", `alert`).appendTo(bugsContainer);
                            $("<h4>").addClass("alert-heading").html(`<span>Bugs</span>`).appendTo(bugsContainerDanger);
                            var bugHtmlString = "";

                            if (data.bugs.length > 0 && Array.isArray(data.bugs)) {
                                var bugs = data.bugs;
                                bugs.forEach((bug, index) => {
                                    bugHtmlString += '<p class="mb-0">' +
                                        `<strong>Bug ${index + 1}:</strong> ${bug.issue}` +
                                        '<pre class="bg-dark text-white mt-2 mb-2">' +
                                        `<code class="language-xml">&lt;${bug.code_in_file}" /&gt;</code>` +
                                        '</pre>';

                                    if (bug.recommendation && Array.isArray(bug.recommendation)) {
                                        var recommendations = bug.recommendation;
                                        bugHtmlString += '<strong>Recommendation:</strong>' +
                                            '<ul>';
                                        recommendations.forEach((recommendation, index) => {
                                            bugHtmlString += `<li>${recommendation}</li>`;
                                        });
                                        bugHtmlString += '</ul>';
                                    }

                                    bugHtmlString += '</p>';
                                });
                            } else {
                                bugHtmlString += '<strong>No Bugs Found</strong>';
                            }

                            $(bugHtmlString).appendTo(bugsContainerDanger);

                            // Alert Section
                            var alertsContainer = $("<div>").addClass("row mt-2").appendTo(insightContainer);
                            var alertsContainerWarning = $("<div>").addClass("alert alert-warning").attr("role", `alert`).appendTo(alertsContainer);
                            $("<h4>").addClass("alert-heading").html(`<span">Alerts</span>`).appendTo(alertsContainerWarning);
                            var alertHtmlString = "";

                            if (data.alerts.length > 0 && Array.isArray(data.alerts)) {
                                var alerts = data.alerts;
                                alertHtmlString += '<ul>';
                                alerts.forEach((alert, index) => {
                                    alertHtmlString += `<li>${alert}</li>`;
                                });
                                alertHtmlString += '</ul>';
                            } else {
                                alertHtmlString += '<strong>No Alerts Found</strong>';
                            }

                            $(alertHtmlString).appendTo(alertsContainerWarning);

                            // General Recommendations Section
                            var generalRecommendationContainer = $("<div>").addClass("row mt-2").appendTo(insightContainer);
                            var generalRecommendationContainerInfo = $("<div>").addClass("alert alert-info").attr("role", `alert`).appendTo(generalRecommendationContainer);
                            $("<h4>").addClass("alert-heading").html(`<span">General Recommendations</span>`).appendTo(generalRecommendationContainerInfo);
                            var generalRecommendationHtmlString = "";

                            if (data.general_recommendation.length > 0 && Array.isArray(data.general_recommendation)) {
                                var generalRecommendation = data.general_recommendation;
                                generalRecommendationHtmlString += '<ul>';
                                generalRecommendation.forEach((recommendation, index) => {
                                    generalRecommendationHtmlString += `<li>${recommendation}</li>`;
                                });
                                generalRecommendationHtmlString += '</ul>';
                            } else {
                                generalRecommendationHtmlString += '<strong>No Recommendation Found</strong>';
                            }

                            $(generalRecommendationHtmlString).appendTo(generalRecommendationContainerInfo);
                            $("<hr>").appendTo(generalRecommendationContainer);
                        });
                    } else {
                        // If jsonData is not a valid JSON array, display it as a string
                        $('#bugDetectionInApplicationFlowContainer').empty();
                        $('#bugDetectionInApplicationFlowContainer').html(`<h3>${jsonData.message}</h3>`);
                    }
                },

                complete: function () {
                    l.stop();
                },
                error: function (err) {
                    l.stop();
                    console.error('Error fetching data:', err);
                    console.log(err.responseText);
                }
            });
        });

        //Test case minimization Insight Call
        $('#testCaseMinimizationNav').click(function () {
            console.log("TCM Clicked")
            var l = Ladda.create(this);
            l.start();
            $.ajax({
                url: 'get-insights/tcm',
                method: 'GET',
                success: function (resultData) {
                    console.log("TCMD: " + resultData);
                    $('#testCaseMinimizationContainer').empty();
                    $('#testCaseMinimizationContainer').html(resultData);
                },
                complete: function () {
                    l.stop();
                },
                error: function (err) {
                    l.stop()
                    console.error('Error fetching data:', err);

                    try {
                        var errorData = JSON.parse(err.responseText);
                        console.log('Error data:', errorData);
                    } catch (e) {
                        console.error('Error parsing JSON:', e);
                    }

                }
            });

        });

        //Custom Code Linting Insight Call
        $('#customCodeLintingNav').click(function () {
            console.log("CCL Clicked")
            var l = Ladda.create(this);
            l.start();
            $.ajax({
                url: 'get-insights/ccl',
                method: 'GET',
                dataType: 'json',
                success: function (jsonData) {
                    console.log("jsonData: " + jsonData)
                    $('#customCodeLintingContainer').empty();
                    if (Array.isArray(jsonData)) {
                        var insightContainer = $("<div>").addClass("container").appendTo("#customCodeLintingContainer");
                        $("<br>").appendTo(insightContainer);
                        jsonData.forEach((data, index) => {
                            $("<h5>").html(`<strong>Developer: </strong><span style="color: red;">${data.developer}</span>`).appendTo(insightContainer);
                            $("<h5>").html(`<strong>PR Title: </strong><span>${data.pr_title}</span>`).appendTo(insightContainer);
                            // lintings Section
                            var lintingsContainer = $("<div>").addClass("row mt-2").appendTo(insightContainer);
                            var lintingsContainerDanger = $("<div>").addClass("alert alert-danger").attr("role", `alert`).appendTo(lintingsContainer);
                            $("<h4>").addClass("alert-heading").html(`<span>Linting Insights</span>`).appendTo(lintingsContainerDanger);
                            var lintingHtmlString = "";

                            if (data.lintings.length > 0 && Array.isArray(data.lintings)) {
                                var lintings = data.lintings;
                                lintings.forEach((linting, index) => {
                                    lintingHtmlString += '<p class="mb-0">' +
                                        `<strong>Linting Issue:</strong> ${linting.issue}<br>` +
                                        `<strong>File Location:</strong> ${linting.file_location}<br>` +
                                        `<strong>Code Line:</strong> <br>` +
                                        '<pre class="bg-dark text-white mt-2 mb-2">' +
                                        `<code class="language-xml">&lt;${linting.code_in_file}" /&gt;</code>` +
                                        '</pre>';

                                    if (linting.linting_comments && Array.isArray(linting.linting_comments)) {
                                        var comments = linting.linting_comments;
                                        lintingHtmlString += '<strong>Comments:</strong>' +
                                            '<ul>';
                                        comments.forEach((comment, index) => {
                                            lintingHtmlString += `<li>${comment}</li>`;
                                        });
                                        lintingHtmlString += '</ul>';
                                    }

                                    lintingHtmlString += '</p>';
                                });
                            } else {
                                lintingHtmlString += '<strong>No Comments Found</strong>';
                            }
                            $(lintingHtmlString).appendTo(lintingsContainerDanger);
                        });
                    } else {
                        // If jsonData is not a valid JSON array, display it as a string
                        $('#customCodeLintingContainer').empty();
                        $('#customCodeLintingContainer').html(`<h3>${jsonData.message}</h3>`);
                    }
                },

                complete: function () {
                    l.stop();
                },
                error: function (err) {
                    l.stop();
                    console.error('Error fetching data:', err);
                    console.log(err.responseText);
                }
            });
        });

        //Collaboration Analysis Insight Call
        $('#collaborationAnalysisNav').click(function () {
            console.log("CA Clicked");
            var l = Ladda.create(this);
            l.start();
            $.ajax({
                url: 'get-repo-prs-collab',
                method: 'GET',
                success: function (data) {
                    console.log(data);
                    $('#collaborationAnalysisContainer').empty();
                    $('#collaborationAnalysisContainer').html(data);
                },
                complete: function () {
                    //$("#insightsTitle").html($('#collaborationAnalysisNav').text());
                    l.stop();
                },
                error: function (err) {
                    l.stop();
                    console.error('Error fetching data:', err);
                    console.log(err.responseText);
                }
            });
        });

        //Dependency Version Insight Call
        $('#dependencyVersionNav').click(function () {
            console.log("DV Clicked");
            var l = Ladda.create(this);
            l.start();
            $.ajax({
                url: 'get-insights/dvc',
                method: 'GET',
                success: function (data) {
                    console.log(data);
                    $('#dependencyVersionContainer').empty();
                    $('#dependencyVersionContainer').html(data);
                },
                complete: function () {
                    l.stop();
                },
                error: function (err) {
                    l.stop();
                    console.error('Error fetching data:', err);
                    console.log(err.responseText);
                }
            });
        });

        //AdvanceCodeSearch Insight Call
        $('#advanceCodeSearchNav').click(function () {
            console.log("Adv. Code Search Clicked");
            var inputData = encodeURIComponent($('#inputData').val());
            $('#inputData').val('');
            console.log(inputData);
            var l = Ladda.create(this);
            l.start();
            $.ajax({
                url: 'advanced-code-search',
                method: 'GET',
                data: {inputData: inputData},
                success: function (data) {
                    console.log(data);
                    $('#advanceCodeSearchContainer').empty();
                    $('#advanceCodeSearchContainer').html(data);
                },
                complete: function () {
                    //$("#insightsTitle").html($('#collaborationAnalysisNav').text());
                    l.stop();
                },
                error: function (err) {
                    l.stop();
                    console.error('Error fetching data:', err);
                    console.log(err.responseText);
                }
            });
        });
    }

    function getRandomColor() {
        // Generates a random RGB value
        var r = Math.floor(Math.random() * 256);
        var g = Math.floor(Math.random() * 256);
        var b = Math.floor(Math.random() * 256);

        // Returns both the rgba color for background and rgb for border
        return {
            backgroundColor: 'rgba(' + r + ', ' + g + ', ' + b + ', 0.2)', // Opacity at 0.2 for background color
            borderColor: 'rgba(' + r + ', ' + g + ', ' + b + ', 1)' // Full opacity for border color
        };
    }
</script>

</body>
</html>